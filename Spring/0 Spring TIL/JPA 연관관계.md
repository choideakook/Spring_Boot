# JPA 연관관계

[🔗 참고 블로그](https://jeong-pro.tistory.com/231)

## ✏️ 연관 관계 정의 규칙

연관 관계를 매핑할 때 고려해야할 것

- 방향 : 단방향 , 양방향 (객체 참조)
- 연관 관계의 주인 : 양방향의 경우 연관관계에서 관리 주체
- 다중성 : 다대일 , 일대다 , 일대일 , 다대다

<br>

## ✏️ 연관관계의 방식

- Table 은 외래 키를 사용해 다른 Table 과 연관관계를 맺는다.
    - 외래 키 (FK) 하나로 양쪽에서 조회 가능 (항상 양방향)
    - 따라서 DB 는 양방향과 단방향을 나눌 필요가 없음
- 객체는 참조값을 사용해 다른 객체와 연관관계를 맺는다.
    - 참조가 있는쪽에서만 조회 가능
    - 한쪽만 참조가 있는경우 단방향, 양쪽 다 참조가 있을경우는 양방향
    - 엄밀히 말하자면 양방향이 아닌 ↔️ 두 객체가 단방향 참조를 각각 가져 양방향 처럼 사용됨 ⬅️ ➡️

<br>

## ✏️ 외래 키 (Foreign key)

<img width="600" alt="FK" src="https://user-images.githubusercontent.com/115536240/211440650-a71c81a5-9877-4bd0-a37b-befbc9dab1fe.png">

- 외래 키 (FK) 는 Table 과 Table 을 연결해주는 역활을 한다.
- 외래 키는 Table 을 다른 Table 에 의존하게 만든다.
- 외래 키는 다른 Table 의 PK 를 참조한다.
- <br>

## ✏️ 연관관계의 주인 (Owner)

- 연관관계의 주인을 지정하는 것은 양방향 관계의 두 객체중 제어의 권한을 갖는 실질적인 관계가 어떤것인지 JPA 에게 알려주는 작업을 뜻한다.
    - 제어의 권한 : 외래 키를 비롯한 테이블 레코드를 저장, 수정, 삭제 처리하는 권한
- Owner 는 연관 관계를 갖는 두 객체 사이에서 조회, 저장, 수정, 삭제를 할 수 있다.
    - non-owning side 는 조회만 가능하다.
- 외래키가 있는 Table 을 Owner 로 지정해주면 된다.
    - 1:N 의 경우 N 이 Owner
    - Collection 이 존재할경우 Collection 을 갖고있는 쪽이 Owner
    - Owner
        - name = “non-owning side 의 PK 명”
    - Non-owning side
        - mappeBy = “Owner 의 FK 필드명”
- 1:1 관계일때 의존관계 주인은 양쪽 다 FK 를 갖고있고 둘 다 Owner 가 될 수 있다.
    - Onwer 를 어디에 해주냐에 따라 장단점이 있지만 엑세스를 많이 하는쪽에 두는게 좋다.
