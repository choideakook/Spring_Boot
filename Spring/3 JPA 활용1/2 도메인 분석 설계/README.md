# 요구사항 분석

## ✏️ 기능 목록

- 회원 기능
    - 회원 등록
    - 회원 조회
- 상품 기능
    - 상품 등록
    - 상품 수정
    - 상품 조회
- 주문 기능
    - 상품 주문
    - 주문 내역 조회
    - 주문 취소
- 기타 요구사항
    - 상품은 제고 관리가 필요하다.
    - 상품의 종류는 도서, 음반, 영화가 있다.
    - 상품을 카테고리로 구분할 수 있다.
    - 상품 주문시 배송 정보를 입력할 수 있다.

<br>

## ✏️ 도메인 모델과 테이블 설계

[🔗 다이어그램 기호 및 표기법](https://mjn5027.tistory.com/43)

### 📍 회원 , 주문 , 상품의 관계

<img width="600" src="https://user-images.githubusercontent.com/115536240/211179949-2b37fdfb-3bec-4d77-a884-f553834515ca.png">

- 회원은 여러 상품을 주문할 수 있기 때문에 주문과 일대다 관계이다.
- 주문상품이라는 엔티티를 추가해 다대다 관계를 일대다 , 다대일 관계로 풀어냈다.
    - 한 번 주문할 때 여러 상품을 선택할 수 있으므로 주문과 상품은 다대다 관계이다.
    - 다대다 관계는 관계형 데이터베이스, 엔티티에서 거의 사용하지 않는다.
- 상품 분류
    - 도서, 음반, 영화로 구분되어 상품이라는 공통 속성을 사용하므로 상속 구조로 표현했다.

### 📍 회원 엔티티 분석

<img width="600" src="https://user-images.githubusercontent.com/115536240/211179950-b66d4d26-e73d-4668-aa52-fd17fc5dd415.png">

- 회원 (Member)
    - 이름과 [🔗 임베디드 타입](https://velog.io/@conatuseus/JPA-임베디드-타입embedded-type-8ak3ygq8wo)인 주소 (Address), 그리고 주문 (Orders) 리스트를 가진다.
    - 사실 회원에서는 주문을 참조할 필요 없이 주문과 단방향 연관관계로 설계하는게 맞지만 예제의 풍성화를 위해 강의에서는 주문을 참조해 양방향 연관관계로 설계했다.
- 주문 (Order)
    - 한 번 주문시 여러 상품을 주문할 수 있으므로 주문과 주문상품 (ORderItem) 은 일대다 관계이다.
    - 주문은 상품을 주문한 회원과 배송 정보, 주문 날짜, 주문 상태 (status) 를 가지고 있다.
    - 주문상태는 열거형 (Enum) 을 사용했는데 주문 (Order), 취소 (Cancel) 을 표현할 수 있다.
- 주문상품 (OrderItem)
    - 주문한 상품 정보와 주문 금액 (orderPrice), 주문 수량 (count) 정보를 가지고있다.
    - 보통 OrderLine , LineItem 으로 표현한다.
- 상품 (Item)
    - 이름, 가격, 재고수량 (stockQuantity) 을 가지고 있다.
    - 상품을 주문하면 재고수량이 줄어든다.
    - 상품의 종류는 도서, 음반, 영화가 있는데 각각은 사용하는 속성이 조금씩 다르다.
    - 주문 상품과 일대다 단방향 관계이다.
- 배송 (Delivery)
    - 주문시 하나의 배송 정보를 생성한다.
    - 주문과 배송은 일대일 단방향 관계이다.
- 카테고리 (Category)
    - 상품과 다대다 관계를 맺는다.
    - parent , child 로 부모, 자식 카테고리를 연결한다.
- 주소 (Address)
    - 값 타입 (임배디드 타입) 이다.
    - 회원과 배송 (Delivery) 에서 사용한다.

### 📍 회원 테이블 분석

<img width="600" src="https://user-images.githubusercontent.com/115536240/211179952-e03e5255-e5e9-4ed8-a352-25f11b2cd9ca.png">

- MEMBER
    - 회원 엔티티의 Address 임베디드 타입 정보가 회원 테이블에 그대로 들어갔다.
    - 이것은 DELIVERY 테이블도 마찬가지이다.
- ITEM
    - 엘범, 도서, 영화 타입을 통합해서 하나의 테이블로 만들었다.
        - 싱글테이블 전략
    - DTYPE 컬럼으로 타입을 구분한다.

❗️ 테이블명이 ORDER 가 아니라 ORDERS 인 것은 데이터베이스가 order by 때문에 예약어로 잡고있는경우가 많아 관례상 ORDERS 를 많이 사용한다.

❗️ 실제 코드에서는 DB 에 소문자 +_ 스타일을 사용하겠다.

- 데이터베이스 테이블명, 컬럼명에 대한 관례는 회사마다 다른다.
- 보통은 대문자 +_ 나 소문자 +_ 방식중 하나를 지정해 일관성있게 사용한다.
- 강의에서는 객체와 차이를 나타내기 위해 데이터베이스 테이블과 컬럼명은 대문자를 사용하지만, 실제 코드에서는 소문자 +_ 스타일로 사용한다.

### 📍 연관관계 매핑 분석

- 회원과 주문
    - 일대다, 다대일의 양방향 관계
    - 외래 키가 있는 주문을 연관관계의 주인으로 정하는 것이 좋음
        - ⚠️ Table 에서 일대다 관계는 무조건 다 에 외래 키가 있음
        - Order.member 를 ORDERS.MEMBER_ID 외래 키와 매핑함
- 주문상품과 주문
    - 다대일 양방향 관계
    - 외래 키 (F Key) 가 주문상품에 있으므로 주문상품이 연관관계의 주인임
        - OrderItem.order 를 ORDER_ITEM.ORDER_ID 외래 키와 매핑
- 주문상품과 상품
    - 다대일 단방향 관계
    - OrderItem 을 ORDER_ITEM.ITEM_ID 외래 키와 매핑
- 주문과 배송
    - 일대일 단방향 관계
    - Order.delivery 를 ORDERS.DELIBERY_ID 외래 키와 매핑한다.
- 카테고리와 상품
    - @ManyToMany 를 사용해서 매핑
        - 실무에서는 다대다 관계를 사용하지 않으므로 예제를 보여주기위한 관계이다.
