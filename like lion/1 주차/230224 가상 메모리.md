# 가상 메모리

## ✏️ 가상 메모리란

메모리 관리 기법중 하나로

프로세스 전체 메모리 내에 올라오지 않아도 실행이 가능하도록 하는 기법이다.

<br>

1. 사용자 프로그램이 물리 메모리의 제약에서 벗어난다.
2. 각 프로그램이 더 작은 메모리를 차지하기 때문에 더 많은 프로그램을 동시에 수행이 가능하다.
    - 엄밀하게 말하면 동시수행이 아닌 시분할 방식으로 프로그램을 수행한다.
    - 시분할 방식은 짧은 시간 단위로 프로세스를 바꿔가면서 사용하는 방식이다.
3. 프로그램을 메모리에 올리고 swap 하는데 필요한 IO 횟수가 줄어든다.

<br>

## ✏️ 용어 정리

- memory = main memory = physical memory = 물리 메모리
- 외부 저장 장치 = 보조 저장 장치 = DISK
- OS = Operating System = 운영 체제  = 커널
- IO 작업 = 입출력 작업

<br>

## ✏️ 컴퓨터의 구조

- 프로그램이 실행되는 것 이란 CPU 가 작동된다는 뜻과 동일하다.

<br>

### 📍 CPU 와 DISK 의 관계

- CPU 는 연산할 때 Register 값을 참조한다.
    - Register 는 용량이 적은 자료를 보관하는 매우 빠른 기억장소 이다.
- Register 의 단점을 보완하기 위해 옆에 Main Memory 로 값을 참조한다.
    - main memory 는 저장속도가 보다 조금 느리지만 용량이 조금 더 크다.
    - 이 구조를 Register Main Memory 라고 한다.

```java
  - CPU -        -- 임시저장 -->  - main memory -
register 값 참조                  
```

- Register Main Memory 는 빠르지만 용량이 작고 휘발성의 특징을 갖는다.
- 더 많은 내용을 저장하기 위해서는 DISK 를 사용해야 한다.
    - DISK 는 외부 저장 장치로 느리지만 용량이 크고 비 휘발성의 특징을 갖는다.
- CPU 는 main memory 까지의 값만 참조할 수 있기 때문에 DISK 의 값을 참조하려면 OS 의 도움을 받아서 입출력 작업을 진행해야 한다.

```java
 register    <-- 외부 저장 -->    DISK 
main memory      OS 작업     (외부 저장 장치)
```

<br>

### 📍 프로그램이 실행되는 것이란

- 대부분의 프로그램은 DISK 에 이진법으로 이루어진 실행 파일 형식으로 존재한다.
    - 프로그램이 시작되기 위해선 DISK 의 이진 실행파일이 CPU 에 올라와야 한다.
    - 즉, 프로그램이 시작되기 위해선 DISK 의 이진 파일을 memory 로 가져와 프로세스 형태로 배치되어야 한다.
        - 쉽게 말해 해당 프로그램의 정보가 CPU 가 참조할 수 있는 형태로 물리 메모리에 올라와야 된다는 뜻이다.
- ***구체적인 설명***
    - 실행파일을 실행하면 fork 요청으로 새 프로세스를 생성하고, exec 요청으로 로더를 호출한다.
    - 로더는 새로 생성된 프로세스의 주소공간을 사용해 지정된 실행파일을 올리는 데 사용된다.

<br>

- ***실행중인 프로그램이 많을경우***
    - 프로그램이 실행되기 위해 CPU 에 많은 프로그램이 있다면 DISK 공간에 Swap 영역을 사용한다.
    - Swap 영역은 외부 저장장치에 존재하지만 물리 메모리의 확장 개념으로 상대적으로 빠르고 휘발성의 특징을 갖는다.
        - DISK 의 확장 개념이지만 DISK (파일시스템) 과 별도로 존재하고 특징도 다르다.
    - Swap 영역은 외부 저장장치에 존재하기 때문에 memory 에 파일을 올리기 위해 OS 의 도움을 받아야 한다.
    - Swap 영역은 실행중인 프로세스의 주소공간을 일시적으로 디스크로 내려놓아서 공간을 만들어 낸다.
        - 프로세스가 실행중인 경우에만 일시적으로 존재한다.

```java
memory  <--- os / io ---> DISK : 비휘발성, 느림
        <--- os / io ---> Swap : 휘발성, DISK 보다는 빠름
```

## ✏️ 가상 메모리의 필요성

- 실행되는 프로그램이 많을 경우 물리 메모리의 공간이 부족하게 된다.
    - 이 때 다른 프로세스를 실행해야 한다면 기존 프로세스를 Swap 영역으로 내 쫒고 필요한 프로세스만 물리메모리에 올라와 있는다.
    - 이렇게 되면 Swap 영역과 I/O 가 너무 자주 발생하게 되고, 물리메모리보다 더 큰 프로세스를 실행하게되면 실행조차 되지 않을 수 도 있다.

### 📍 가상 메모리로 문제 해결

- 가상메모리는 실제의 물리 메모리 개념과 논리 메모리 개념을 분리한다.
- 가상 메모리는 프로세스의 모든 부분을 물리 메로리에 올리지 않고 꼭 필요한 부분만 올릴 수 있게해 물리 메모리의 공간을 효율적으로 사용하게 만들어준다.

### 📍 요구 페이징 기법

- 프로세스의 필요한 부분만 물리메모리에 올리는 작업
- 상대적으로 큰 저장영역인 Swap 영역을 활용해 프로세스마다 가상의 주소공간을 확보하고,
필요한 페이지만 물리메모리에 올려 사용함으로써 더 효과적으로 물리 메모리를 사용할 수 있게 된다.
- 운영체제는 프로그램이 물리적 메모리의 크기를 고려할 필요 없이 자기 자신만의 메모리를 사용하는 것처럼 가정하여 프로그램하는 것을 지원한다.

## ✏️ 가상 메모리 사용의 장점

- 프로그램이 물리 메모리 보다 크기가 커도 실행할 수 있게된다.
- 프로세스당 메모리 사용이 감소하고, 더 많은 프로세스를 수용할 수 있다.
- 응답시간이 늘어나지 않으면서 CPU 이용과 처리율이 높아진다.
- IO 가 적게 일어나므로 더 빠른 실행이 가능하다.